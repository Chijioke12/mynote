<!DOCTYPE html><html lang="en"><head><meta name="x-poe-datastore-behavior" content="local_only">
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GitHub Notes - Backend Storage Demo</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/marked@9.1.6/marked.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    colors: {
                        primary: '#5D5CDE'
                    }
                }
            }
        }
    </script>
<script src="https://puc.poecdn.net/authenticated_preview_page/syncedState.3f7572448765332f3047.js"></script></head>
<body class="bg-white dark:bg-gray-900 text-gray-900 dark:text-white min-h-screen transition-colors">
    <div class="container mx-auto max-w-4xl p-4">
        <!-- Header -->
        <header class="text-center mb-8">
            <h1 class="text-3xl font-bold mb-2">
                <i class="fab fa-github mr-2"></i>
                GitHub Notes
            </h1>
            <p class="text-gray-600 dark:text-gray-300">A demo of using GitHub as backend storage</p>
        </header>

        <!-- Authentication Section -->
        <div id="auth-section" class="bg-gray-50 dark:bg-gray-800 rounded-lg p-6 mb-6">
            <h2 class="text-xl font-semibold mb-4">
                <i class="fas fa-key mr-2"></i>
                GitHub Configuration
            </h2>
            <div class="grid md:grid-cols-2 gap-4 mb-4">
                <div>
                    <label class="block text-sm font-medium mb-2">GitHub Token</label>
                    <input type="password" id="github-token" placeholder="ghp_xxxxxxxxxxxxx" class="w-full px-3 py-2 text-base border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-700 focus:ring-2 focus:ring-primary focus:border-transparent">
                    <p class="text-xs text-gray-500 mt-1">
                        <a href="https://github.com/settings/tokens" target="_blank" class="text-primary hover:underline">
                            Create a token
                        </a> with 'repo' permissions
                    </p>
                </div>
                <div>
                    <label class="block text-sm font-medium mb-2">Repository (owner/repo)</label>
                    <input type="text" id="github-repo" placeholder="username/my-notes" class="w-full px-3 py-2 text-base border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-700 focus:ring-2 focus:ring-primary focus:border-transparent">
                </div>
            </div>
            <button id="test-connection" class="bg-primary text-white px-4 py-2 rounded-md hover:bg-opacity-90 transition-colors">
                <i class="fas fa-plug mr-2"></i>
                Test Connection
            </button>
            <div id="connection-status" class="mt-3"></div>
        </div>

        <!-- Main Application -->
        <div id="app-section" class="hidden">
            <!-- Action Bar -->
            <div class="flex justify-between items-center mb-6">
                <h2 class="text-xl font-semibold">
                    <i class="fas fa-sticky-note mr-2"></i>
                    Your Notes
                </h2>
                <button id="new-note-btn" class="bg-primary text-white px-4 py-2 rounded-md hover:bg-opacity-90 transition-colors">
                    <i class="fas fa-plus mr-2"></i>
                    New Note
                </button>
            </div>

            <!-- Notes Grid -->
            <div id="notes-grid" class="grid md:grid-cols-2 lg:grid-cols-3 gap-4 mb-6">
                <!-- Notes will be dynamically added here -->
            </div>

            <!-- Loading State -->
            <div id="loading" class="text-center py-8 hidden">
                <i class="fas fa-spinner fa-spin text-3xl text-primary mb-4"></i>
                <p class="text-gray-600 dark:text-gray-300">Loading notes...</p>
            </div>

            <!-- Empty State -->
            <div id="empty-state" class="text-center py-12 hidden">
                <i class="fas fa-sticky-note text-6xl text-gray-300 dark:text-gray-600 mb-4"></i>
                <h3 class="text-xl font-semibold mb-2">No notes yet</h3>
                <p class="text-gray-600 dark:text-gray-300 mb-4">Create your first note to get started!</p>
                <button onclick="showNoteModal()" class="bg-primary text-white px-6 py-2 rounded-md hover:bg-opacity-90 transition-colors">
                    Create Note
                </button>
            </div>
        </div>

        <!-- Note Modal -->
        <div id="note-modal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 hidden">
            <div class="bg-white dark:bg-gray-800 rounded-lg shadow-xl w-full max-w-2xl mx-4 max-h-[90vh] overflow-y-auto">
                <div class="p-6">
                    <div class="flex justify-between items-center mb-6">
                        <h3 id="modal-title" class="text-xl font-semibold">Create Note</h3>
                        <button onclick="hideNoteModal()" class="text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-200">
                            <i class="fas fa-times text-xl"></i>
                        </button>
                    </div>
                    
                    <form id="note-form">
                        <div class="mb-4">
                            <label class="block text-sm font-medium mb-2">Title</label>
                            <input type="text" id="note-title" required="" class="w-full px-3 py-2 text-base border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-700 focus:ring-2 focus:ring-primary focus:border-transparent">
                        </div>
                        
                        <div class="mb-4">
                            <label class="block text-sm font-medium mb-2">Content (Markdown supported)</label>
                            <textarea id="note-content" rows="10" required="" class="w-full px-3 py-2 text-base border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-700 focus:ring-2 focus:ring-primary focus:border-transparent" placeholder="Write your note in Markdown..."></textarea>
                        </div>
                        
                        <div class="flex justify-end space-x-3">
                            <button type="button" onclick="hideNoteModal()" class="px-4 py-2 text-gray-600 dark:text-gray-400 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-md">
                                Cancel
                            </button>
                            <button type="submit" id="save-btn" class="px-6 py-2 bg-primary text-white rounded-md hover:bg-opacity-90 transition-colors">
                                <i class="fas fa-save mr-2"></i>
                                Save Note
                            </button>
                        </div>
                    </form>
                </div>
            </div>
        </div>

        <!-- Error Toast -->
        <div id="error-toast" class="fixed bottom-4 right-4 bg-red-500 text-white p-4 rounded-lg shadow-lg hidden z-50">
            <div class="flex items-center">
                <i class="fas fa-exclamation-circle mr-2"></i>
                <span id="error-message"></span>
                <button onclick="hideError()" class="ml-4 text-white hover:text-gray-200">
                    <i class="fas fa-times"></i>
                </button>
            </div>
        </div>

        <!-- Success Toast -->
        <div id="success-toast" class="fixed bottom-4 right-4 bg-green-500 text-white p-4 rounded-lg shadow-lg hidden z-50">
            <div class="flex items-center">
                <i class="fas fa-check-circle mr-2"></i>
                <span id="success-message"></span>
            </div>
        </div>
    </div>

    <script>
        // Dark mode setup
        if (window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches) {
            document.documentElement.classList.add('dark');
        }
        window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change', event => {
            if (event.matches) {
                document.documentElement.classList.add('dark');
            } else {
                document.documentElement.classList.remove('dark');
            }
        });

        // Global state
        let githubConfig = {
            token: '',
            repo: '',
            owner: '',
            repoName: ''
        };
        let notes = [];
        let editingNote = null;

        // GitHub API wrapper
        class GitHubAPI {
            constructor(token, owner, repo) {
                this.token = token;
                this.owner = owner;
                this.repo = repo;
                this.baseUrl = 'https://api.github.com';
            }

            async request(endpoint, options = {}) {
                const url = `${this.baseUrl}${endpoint}`;
                const config = {
                    headers: {
                        'Authorization': `token ${this.token}`,
                        'Accept': 'application/vnd.github.v3+json',
                        'Content-Type': 'application/json',
                        ...options.headers
                    },
                    ...options
                };

                const response = await fetch(url, config);
                
                if (!response.ok) {
                    const error = await response.json().catch(() => ({ message: 'Unknown error' }));
                    throw new Error(error.message || `HTTP ${response.status}`);
                }

                return await response.json();
            }

            async getFile(path) {
                return await this.request(`/repos/${this.owner}/${this.repo}/contents/${path}`);
            }

            async createOrUpdateFile(path, content, message, sha = null) {
                const body = {
                    message,
                    content: btoa(unescape(encodeURIComponent(content))),
                };
                if (sha) body.sha = sha;

                return await this.request(`/repos/${this.owner}/${this.repo}/contents/${path}`, {
                    method: 'PUT',
                    body: JSON.stringify(body)
                });
            }

            async deleteFile(path, message, sha) {
                return await this.request(`/repos/${this.owner}/${this.repo}/contents/${path}`, {
                    method: 'DELETE',
                    body: JSON.stringify({
                        message,
                        sha
                    })
                });
            }

            async listContents(path = '') {
                return await this.request(`/repos/${this.owner}/${this.repo}/contents/${path}`);
            }

            async testConnection() {
                return await this.request(`/repos/${this.owner}/${this.repo}`);
            }
        }

        // Utility functions
        function showError(message) {
            document.getElementById('error-message').textContent = message;
            document.getElementById('error-toast').classList.remove('hidden');
            setTimeout(() => hideError(), 5000);
        }

        function hideError() {
            document.getElementById('error-toast').classList.add('hidden');
        }

        function showSuccess(message) {
            document.getElementById('success-message').textContent = message;
            document.getElementById('success-toast').classList.remove('hidden');
            setTimeout(() => {
                document.getElementById('success-toast').classList.add('hidden');
            }, 3000);
        }

        function showLoading() {
            document.getElementById('loading').classList.remove('hidden');
            document.getElementById('empty-state').classList.add('hidden');
        }

        function hideLoading() {
            document.getElementById('loading').classList.add('hidden');
        }

        function generateNoteId() {
            return Date.now().toString(36) + Math.random().toString(36).substr(2);
        }

        function formatDate(dateString) {
            return new Date(dateString).toLocaleString();
        }

        // Note modal functions
        function showNoteModal(note = null) {
            editingNote = note;
            const modal = document.getElementById('note-modal');
            const title = document.getElementById('modal-title');
            const form = document.getElementById('note-form');
            const titleInput = document.getElementById('note-title');
            const contentInput = document.getElementById('note-content');

            if (note) {
                title.textContent = 'Edit Note';
                titleInput.value = note.title;
                contentInput.value = note.content;
            } else {
                title.textContent = 'Create Note';
                form.reset();
            }

            modal.classList.remove('hidden');
            titleInput.focus();
        }

        function hideNoteModal() {
            document.getElementById('note-modal').classList.add('hidden');
            editingNote = null;
        }

        // GitHub operations
        async function testConnection() {
            const token = document.getElementById('github-token').value.trim();
            const repo = document.getElementById('github-repo').value.trim();
            
            if (!token || !repo) {
                showError('Please enter both GitHub token and repository');
                return;
            }

            const [owner, repoName] = repo.split('/');
            if (!owner || !repoName) {
                showError('Repository format should be: owner/repo');
                return;
            }

            const statusEl = document.getElementById('connection-status');
            statusEl.innerHTML = '<i class="fas fa-spinner fa-spin mr-2"></i>Testing connection...';
            statusEl.className = 'mt-3 text-blue-600';

            try {
                const api = new GitHubAPI(token, owner, repoName);
                await api.testConnection();
                
                githubConfig = { token, repo, owner, repoName };
                
                statusEl.innerHTML = '<i class="fas fa-check-circle mr-2"></i>Connected successfully!';
                statusEl.className = 'mt-3 text-green-600';
                
                document.getElementById('auth-section').classList.add('hidden');
                document.getElementById('app-section').classList.remove('hidden');
                
                loadNotes();
            } catch (error) {
                statusEl.innerHTML = `<i class="fas fa-times-circle mr-2"></i>Connection failed: ${error.message}`;
                statusEl.className = 'mt-3 text-red-600';
            }
        }

        async function loadNotes() {
            showLoading();
            
            try {
                const api = new GitHubAPI(githubConfig.token, githubConfig.owner, githubConfig.repoName);
                const contents = await api.listContents('notes');
                
                notes = [];
                for (const file of contents.filter(f => f.name.endsWith('.json'))) {
                    try {
                        const fileData = await api.getFile(file.path);
                        const content = JSON.parse(atob(fileData.content));
                        notes.push({
                            ...content,
                            filename: file.name,
                            sha: fileData.sha,
                            path: file.path
                        });
                    } catch (e) {
                        console.warn('Failed to load note:', file.name, e);
                    }
                }
                
                renderNotes();
            } catch (error) {
                if (error.message.includes('404')) {
                    // Notes directory doesn't exist yet, that's okay
                    notes = [];
                    renderNotes();
                } else {
                    showError(`Failed to load notes: ${error.message}`);
                }
            }
            
            hideLoading();
        }

        function renderNotes() {
            const grid = document.getElementById('notes-grid');
            const emptyState = document.getElementById('empty-state');
            
            if (notes.length === 0) {
                grid.innerHTML = '';
                emptyState.classList.remove('hidden');
                return;
            }
            
            emptyState.classList.add('hidden');
            
            // Sort notes by creation date (newest first)
            notes.sort((a, b) => new Date(b.createdAt) - new Date(a.createdAt));
            
            grid.innerHTML = notes.map(note => `
                <div class="bg-gray-50 dark:bg-gray-800 rounded-lg p-4 border border-gray-200 dark:border-gray-700 hover:shadow-md transition-shadow">
                    <div class="flex justify-between items-start mb-3">
                        <h3 class="font-semibold text-lg truncate">${escapeHtml(note.title)}</h3>
                        <div class="flex space-x-2">
                            <button onclick="showNoteModal(${JSON.stringify(note).replace(/"/g, '&quot;')})" 
                                    class="text-blue-500 hover:text-blue-700 dark:text-blue-400 dark:hover:text-blue-300">
                                <i class="fas fa-edit"></i>
                            </button>
                            <button onclick="deleteNote('${note.filename}')" 
                                    class="text-red-500 hover:text-red-700 dark:text-red-400 dark:hover:text-red-300">
                                <i class="fas fa-trash"></i>
                            </button>
                        </div>
                    </div>
                    
                    <div class="prose dark:prose-invert max-w-none mb-3">
                        ${marked.parse(note.content.substring(0, 150) + (note.content.length > 150 ? '...' : ''))}
                    </div>
                    
                    <div class="text-xs text-gray-500 dark:text-gray-400">
                        <i class="far fa-clock mr-1"></i>
                        ${formatDate(note.createdAt)}
                        ${note.updatedAt && note.updatedAt !== note.createdAt ? 
                            `<span class="ml-2"><i class="fas fa-edit mr-1"></i>Updated ${formatDate(note.updatedAt)}</span>` : ''}
                    </div>
                </div>
            `).join('');
        }

        function escapeHtml(text) {
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }

        async function saveNote() {
            const titleInput = document.getElementById('note-title');
            const contentInput = document.getElementById('note-content');
            const saveBtn = document.getElementById('save-btn');
            
            const title = titleInput.value.trim();
            const content = contentInput.value.trim();
            
            if (!title || !content) {
                showError('Please enter both title and content');
                return;
            }

            saveBtn.disabled = true;
            saveBtn.innerHTML = '<i class="fas fa-spinner fa-spin mr-2"></i>Saving...';

            try {
                const api = new GitHubAPI(githubConfig.token, githubConfig.owner, githubConfig.repoName);
                
                let note, filename, path;
                
                if (editingNote) {
                    // Update existing note
                    note = {
                        ...editingNote,
                        title,
                        content,
                        updatedAt: new Date().toISOString()
                    };
                    filename = editingNote.filename;
                    path = editingNote.path;
                } else {
                    // Create new note
                    const noteId = generateNoteId();
                    filename = `${noteId}.json`;
                    path = `notes/${filename}`;
                    note = {
                        id: noteId,
                        title,
                        content,
                        createdAt: new Date().toISOString(),
                        updatedAt: new Date().toISOString()
                    };
                }

                const noteContent = JSON.stringify(note, null, 2);
                const commitMessage = editingNote ? 
                    `Update note: ${title}` : 
                    `Create note: ${title}`;

                await api.createOrUpdateFile(
                    path, 
                    noteContent, 
                    commitMessage,
                    editingNote?.sha
                );

                showSuccess(editingNote ? 'Note updated successfully!' : 'Note created successfully!');
                hideNoteModal();
                loadNotes();

            } catch (error) {
                showError(`Failed to save note: ${error.message}`);
            } finally {
                saveBtn.disabled = false;
                saveBtn.innerHTML = '<i class="fas fa-save mr-2"></i>Save Note';
            }
        }

        async function deleteNote(filename) {
            if (!showConfirmDialog(`Are you sure you want to delete this note?`, async () => {
                const note = notes.find(n => n.filename === filename);
                if (!note) return;

                try {
                    const api = new GitHubAPI(githubConfig.token, githubConfig.owner, githubConfig.repoName);
                    await api.deleteFile(note.path, `Delete note: ${note.title}`, note.sha);
                    
                    showSuccess('Note deleted successfully!');
                    loadNotes();
                } catch (error) {
                    showError(`Failed to delete note: ${error.message}`);
                }
            })) return;
        }

        function showConfirmDialog(message, onConfirm) {
            const modal = document.createElement('div');
            modal.className = 'fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50';
            modal.innerHTML = `
                <div class="bg-white dark:bg-gray-800 p-6 rounded-lg shadow-lg max-w-sm w-full mx-4">
                    <p class="text-gray-700 dark:text-gray-300 mb-4">${message}</p>
                    <div class="flex justify-end space-x-3">
                        <button class="cancel-btn px-4 py-2 text-gray-600 dark:text-gray-400 hover:bg-gray-100 dark:hover:bg-gray-700 rounded">Cancel</button>
                        <button class="confirm-btn px-4 py-2 bg-red-500 text-white hover:bg-red-600 rounded">Delete</button>
                    </div>
                </div>
            `;
            
            modal.querySelector('.cancel-btn').onclick = () => {
                document.body.removeChild(modal);
            };
            
            modal.querySelector('.confirm-btn').onclick = () => {
                document.body.removeChild(modal);
                onConfirm();
            };
            
            document.body.appendChild(modal);
            return true;
        }

        // Event listeners
        document.getElementById('test-connection').addEventListener('click', testConnection);
        document.getElementById('new-note-btn').addEventListener('click', () => showNoteModal());
        document.getElementById('note-form').addEventListener('submit', (e) => {
            e.preventDefault();
            saveNote();
        });

        // Keyboard shortcuts
        document.addEventListener('keydown', (e) => {
            if (e.key === 'Escape') {
                hideNoteModal();
            }
        });
    </script>


</body></html>